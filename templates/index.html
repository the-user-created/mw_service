<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature Logger and Camera Feed</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            font-weight: bold;
            background-color: #f2f2f2;
        }
        .container {
            display: flex;
            justify-content: space-between;
        }
        .container div {
            width: 45%;
        }
    </style>
</head>
<body>
    <h1>Temperature Logger and Live Camera Feed</h1>

    <!-- Form to start and stop logging -->
    <form method="POST" action="/start">
       <label for="power">Power Setting:</label>
       <input type="text" id="power" name="power" required>

       <label for="catalyst">Catalyst:</label>
       <input type="text" id="catalyst" name="catalyst" required>

       <label for="microwave_duration_minutes">Microwave Duration (minutes):</label>
       <input type="number" id="microwave_duration_minutes" name="microwave_duration_minutes" required>

       <label for="microwave_duration_seconds">Microwave Duration (seconds):</label>
       <input type="number" id="microwave_duration_seconds" name="microwave_duration_seconds" required>

       <button type="submit">Start Logging</button>
    </form>

    <form method="POST" action="/stop">
        <button type="submit">Stop Logging</button>
    </form>

    <div class="container">
        <div>
            <h2>Recorded Data</h2>
            <table id="data-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Thermistor 1</th>
                        <th>Thermistor 2</th>
                        <th>Thermistor 3</th>
                        <th>Thermistor 4</th>
                        <th>Thermocouple</th>
                        <th>Comment</th>
                    </tr>
                </thead>
                <tbody id="data-table-body">
                    <!-- Real-time data will be inserted here dynamically -->
                </tbody>
            </table>
        </div>

        <div>
            <h2>Live Camera Feed</h2>
            <img src="{{ url_for('video_feed') }}" alt="Live Feed" width="100%">
        </div>
    </div>

    <div class="comment-container">
        <h3>Add Comment to a Data Point</h3>
        <form method="POST" action="/add_comment">
            <label for="timestamp">Select Timestamp:</label>
            <select id="timestamp" name="timestamp" required>
                <!-- Timestamps will be inserted here dynamically -->
            </select>

            <label for="comment">Comment:</label>
            <input type="text" id="comment" name="comment" required>

            <button type="submit">Add Comment</button>
        </form>
    </div>

    <div>
        <h3>After you stop logging, your files will be available for 10 minutes:</h3>
        <p>Download them before they are deleted:</p>
        <a href="/download_log">Download Log File</a> |
        <a href="/download_video">Download Video File</a>
    </div>

    <script>
        function fetchData() {
            fetch('/get_latest_data')
                .then(response => response.json())
                .then(data => {
                    let tableBody = document.getElementById("data-table-body");
                    let timestampSelect = document.getElementById("timestamp");

                    tableBody.innerHTML = "";  // Clear existing rows
                    timestampSelect.innerHTML = "";  // Clear existing options

                    data.forEach(row => {
                        let tr = document.createElement("tr");
                        row.forEach((cell, index) => {
                            let td = document.createElement("td");
                            td.innerText = cell;
                            tr.appendChild(td);
                        });

                        // Add the row to the table body
                        tableBody.appendChild(tr);

                        // Add the timestamp to the dropdown
                        let option = document.createElement("option");
                        option.value = row[0];  // Assuming timestamp is the first column
                        option.innerText = row[0];
                        timestampSelect.appendChild(option);
                    });
                });
        }

        setInterval(fetchData, 1000);  // Fetch new data every second
    </script>
</body>
</html>